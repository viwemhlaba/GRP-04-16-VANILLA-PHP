import{r as b,m as G,j as e,L as J,$ as K}from"./app-DD1_j264.js";import{H as O}from"./heading-dqUOBQxD.js";import{B as o}from"./createLucideIcon-CJXjctMu.js";import{C as m,a as h,b as x,c as p,d as j}from"./card-DMpxeHKD.js";import{C as U}from"./checkbox-CmdZUS2u.js";import{I as l}from"./input-cZgy-9z1.js";import{L as a}from"./label-D4qny3wm.js";import{S as g,a as v,b as _,c as N,d as y}from"./select-8dGr2CsA.js";import{T as W}from"./textarea-3mhvGArJ.js";import{A as Z,X as D,t as F}from"./app-layout-BjO8UPhY.js";import{P as S}from"./plus-CWERYZzN.js";import{T as ee}from"./trash-2-2fdkUjjd.js";import"./index-CR58GS18.js";import"./index-Db2yqOI4.js";import"./index-D6cg2Mm3.js";import"./app-logo-DcjKhG5i.js";import"./pill-BS0WEZWH.js";function _e({customers:k,doctors:M,medications:I,activeIngredients:T}){const[q,w]=b.useState(!1),[E,C]=b.useState(!1),[d,L]=b.useState(null),{data:r,setData:i,post:R,processing:P,errors:se}=G({customer_id:"",new_customer:{name:"",surname:"",email:"",id_number:"",cellphone_number:""},allergies_type:"none",allergies:[],doctor_id:"",new_doctor:{name:"",surname:"",email:"",phone:"",practice_number:""},prescription_name:"",delivery_method:"pickup",repeats_total:0,items:[{medication_id:"",quantity:1,instructions:"",price:0}],pharmacy_notes:""}),V=s=>{i("customer_id",s);const n=k.find(t=>t.id.toString()===s);L(n||null),w(!1)},f=(s,n,t)=>{const c=[...r.items];if(c[s]={...c[s],[n]:t},n==="medication_id"||n==="quantity"){const u=n==="medication_id"?t:c[s].medication_id,X=n==="quantity"?t:c[s].quantity;if(u){const A=I.find(Y=>Y.id===parseInt(u));A&&(c[s].price=X*A.current_sale_price)}}i("items",c)},$=()=>{const s=r.items;i("items",[...s,{medication_id:"",quantity:1,instructions:"",price:0}])},z=s=>{const n=r.items;if(n.length>1){const t=n.filter((c,u)=>u!==s);i("items",t)}},H=r.items.reduce((s,n)=>s+(n.price||0),0),B=s=>{const n=r.allergies,t=n.includes(s)?n.filter(c=>c!==s):[...n,s];i("allergies",t)},Q=s=>{s.preventDefault(),R(route("pharmacist.prescriptions.storeManual"),{onSuccess:()=>{F.success("Manual prescription created successfully!")},onError:n=>{console.error("Error creating prescription:",n),F.error("Failed to create prescription. Please check for errors.")}})};return e.jsxs(Z,{children:[e.jsx(J,{title:"Create Manual Prescription"}),e.jsxs("div",{className:"mx-auto max-w-4xl space-y-6 px-4 py-6 sm:px-6 lg:px-8",children:[e.jsx(O,{title:"Create Manual Prescription"}),e.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Customer Information"}),e.jsx(p,{children:"Select an existing customer or add a new one"})]}),e.jsx(j,{className:"space-y-4",children:q?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(a,{className:"text-base font-medium",children:"Add New Customer"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>w(!1),children:e.jsx(D,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{children:"First Name"}),e.jsx(l,{value:r.new_customer.name,onChange:s=>i("new_customer",{...r.new_customer,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Last Name"}),e.jsx(l,{value:r.new_customer.surname,onChange:s=>i("new_customer",{...r.new_customer,surname:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Email"}),e.jsx(l,{type:"email",value:r.new_customer.email,onChange:s=>i("new_customer",{...r.new_customer,email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(a,{children:"ID Number"}),e.jsx(l,{value:r.new_customer.id_number,onChange:s=>i("new_customer",{...r.new_customer,id_number:s.target.value})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(a,{children:"Cell Phone Number"}),e.jsx(l,{value:r.new_customer.cellphone_number,onChange:s=>i("new_customer",{...r.new_customer,cellphone_number:s.target.value})})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(a,{htmlFor:"customer_select",children:"Select Customer"}),e.jsxs(g,{onValueChange:V,children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Choose a customer..."})}),e.jsx(N,{children:k.map(s=>e.jsxs(y,{value:s.id.toString(),children:[s.full_name," - ",s.email]},s.id))})]})]}),e.jsxs(o,{type:"button",variant:"outline",onClick:()=>w(!0),className:"mt-6",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Add New Customer"]})]}),d&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 rounded-lg bg-gray-50 p-4",children:[e.jsxs("div",{children:[e.jsx(a,{children:"ID Number"}),e.jsx("p",{className:"text-sm text-gray-600",children:d.id_number})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Email"}),e.jsx("p",{className:"text-sm text-gray-600",children:d.email})]}),e.jsxs("div",{children:[e.jsx(a,{children:"First Name"}),e.jsx("p",{className:"text-sm text-gray-600",children:d.name})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Last Name"}),e.jsx("p",{className:"text-sm text-gray-600",children:d.surname})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Cell Number"}),e.jsx("p",{className:"text-sm text-gray-600",children:d.cellphone_number})]})]})]})})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Allergies"}),e.jsx(p,{children:"Select customer allergy information"})]}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(a,{children:"Does the customer have any known allergies?"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"allergies_none",name:"allergies_type",value:"none",checked:r.allergies_type==="none",onChange:()=>{i("allergies_type","none"),i("allergies",[])}}),e.jsx(a,{htmlFor:"allergies_none",children:"No allergies"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"allergies_known",name:"allergies_type",value:"known",checked:r.allergies_type==="known",onChange:()=>i("allergies_type","known")}),e.jsx(a,{htmlFor:"allergies_known",children:"Yes, known allergies"})]})]}),r.allergies_type==="known"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Select allergens:"}),e.jsx("div",{className:"grid max-h-40 grid-cols-2 gap-2 overflow-y-auto",children:T.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{id:`allergy_${s.id}`,checked:r.allergies.includes(s.id),onCheckedChange:()=>B(s.id)}),e.jsx(a,{htmlFor:`allergy_${s.id}`,className:"text-sm",children:s.name})]},s.id))})]})]})})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Prescribing Doctor"}),e.jsx(p,{children:"Select an existing doctor or add a new one"})]}),e.jsx(j,{className:"space-y-4",children:E?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(a,{className:"text-base font-medium",children:"Add New Doctor"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(!1),children:e.jsx(D,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{children:"First Name"}),e.jsx(l,{value:r.new_doctor.name,onChange:s=>i("new_doctor",{...r.new_doctor,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Last Name"}),e.jsx(l,{value:r.new_doctor.surname,onChange:s=>i("new_doctor",{...r.new_doctor,surname:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Email"}),e.jsx(l,{type:"email",value:r.new_doctor.email,onChange:s=>i("new_doctor",{...r.new_doctor,email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Phone"}),e.jsx(l,{value:r.new_doctor.phone,onChange:s=>i("new_doctor",{...r.new_doctor,phone:s.target.value})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(a,{children:"Practice Number"}),e.jsx(l,{value:r.new_doctor.practice_number,onChange:s=>i("new_doctor",{...r.new_doctor,practice_number:s.target.value})})]})]})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(a,{children:"Select Doctor"}),e.jsxs(g,{onValueChange:s=>{i("doctor_id",s),C(!1)},children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Choose a doctor..."})}),e.jsx(N,{children:M.map(s=>e.jsxs(y,{value:s.id.toString(),children:["Dr. ",s.name," ",s.surname," - ",s.practice_number]},s.id))})]})]}),e.jsxs(o,{type:"button",variant:"outline",onClick:()=>C(!0),className:"mt-6",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Add New Doctor"]})]})})})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsx(x,{children:"Prescription Details"})}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{children:"Prescription Name"}),e.jsx(l,{value:r.prescription_name,onChange:s=>i("prescription_name",s.target.value),placeholder:"e.g., Monthly Medication"})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Number of Repeats"}),e.jsxs(g,{onValueChange:s=>i("repeats_total",parseInt(s)),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select repeats..."})}),e.jsx(N,{children:[0,1,2,3,4,5].map(s=>e.jsxs(y,{value:s.toString(),children:[s," ",s===1?"repeat":"repeats"]},s))})]})]})]})})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Medication Information"}),e.jsx(p,{children:"Add medications to this prescription"})]}),e.jsxs(j,{className:"space-y-4",children:[r.items.map((s,n)=>e.jsxs("div",{className:"grid grid-cols-12 items-end gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx(a,{children:"Medication"}),e.jsxs(g,{onValueChange:t=>f(n,"medication_id",t),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select medication..."})}),e.jsx(N,{children:I.map(t=>e.jsxs(y,{value:t.id.toString(),children:[t.name," - R",t.current_sale_price]},t.id))})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(a,{children:"Quantity"}),e.jsx(l,{type:"number",min:"1",value:s.quantity,onChange:t=>f(n,"quantity",parseInt(t.target.value)||1)})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(a,{children:"Instructions"}),e.jsx(l,{value:s.instructions,onChange:t=>f(n,"instructions",t.target.value),placeholder:"e.g., Take twice daily"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(a,{children:"Price"}),e.jsxs("p",{className:"text-sm font-medium",children:["R",(s.price||0).toFixed(2)]})]}),e.jsx("div",{className:"col-span-1",children:e.jsx(o,{type:"button",variant:"outline",size:"sm",onClick:()=>z(n),disabled:r.items.length===1,children:e.jsx(ee,{className:"h-4 w-4"})})})]},n)),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(o,{type:"button",variant:"outline",onClick:$,children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Add Medication"]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-lg font-semibold",children:["Total: R",H.toFixed(2)]})})]})]})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Pharmacy Notes"}),e.jsx(p,{children:"Any additional notes or instructions"})]}),e.jsx(j,{children:e.jsx(W,{value:r.pharmacy_notes,onChange:s=>i("pharmacy_notes",s.target.value),placeholder:"Enter any pharmacy notes or special instructions...",rows:3})})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(K,{href:route("pharmacist.prescriptions.index"),children:e.jsx(o,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(o,{type:"submit",disabled:P,children:P?"Creating...":"Approve Prescription"})]})]})]})]})}export{_e as default};
