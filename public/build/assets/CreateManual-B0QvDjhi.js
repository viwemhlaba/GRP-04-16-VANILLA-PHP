import{r as T,m as E,j as e,L as re,$ as L}from"./app-DD1_j264.js";import{B as o}from"./createLucideIcon-CJXjctMu.js";import{C as x,a as p,b as u,c as v,d as j}from"./card-DMpxeHKD.js";import{C as ae}from"./checkbox-CmdZUS2u.js";import{D as te,a as ie,b as ne,c as le,f as ce}from"./dialog-BWut1jda.js";import{I as d}from"./input-cZgy-9z1.js";import{L as t}from"./label-D4qny3wm.js";import{S as f,a as y,b as C,c as b,d as D}from"./select-8dGr2CsA.js";import{T as oe}from"./textarea-3mhvGArJ.js";import{A as de,t as m}from"./app-layout-BjO8UPhY.js";import{P}from"./plus-CWERYZzN.js";import{T as me}from"./trash-2-2fdkUjjd.js";import"./index-CR58GS18.js";import"./index-Db2yqOI4.js";import"./index-D6cg2Mm3.js";import"./app-logo-DcjKhG5i.js";import"./pill-BS0WEZWH.js";function ke({customers:k,doctors:R,medications:M,activeIngredients:V}){const[h,$]=T.useState(null),[I,S]=T.useState(!1),{data:i,setData:n,post:O,processing:F}=E({customer_id:"",allergies_type:"none",allergies:[],doctor_id:"",prescription_name:"",delivery_method:"pickup",repeats_total:0,items:[{medication_id:"",quantity:1,instructions:"",price:0}],pharmacy_notes:""}),{data:g,setData:N,post:B,processing:A,errors:c,reset:H}=E({name:"",surname:"",email:"",phone:"",practice_number:""}),z=s=>{n("customer_id",s);const r=k.find(a=>a.id.toString()===s)||null;$(r)},w=(s,r,a)=>{const l=[...i.items];if(l[s]={...l[s],[r]:a},r==="medication_id"||r==="quantity"){const _=r==="medication_id"?a:l[s].medication_id,ee=r==="quantity"?a:l[s].quantity;if(_){const q=M.find(se=>se.id===parseInt(_));q&&(l[s].price=ee*q.current_sale_price)}}n("items",l)},Q=()=>{const s=i.items;n("items",[...s,{medication_id:"",quantity:1,instructions:"",price:0}])},Y=s=>{const r=i.items;if(r.length>1){const a=r.filter((l,_)=>_!==s);n("items",a)}},G=i.items.reduce((s,r)=>s+(r.price||0),0),J=s=>{const r=i.allergies,a=r.includes(s)?r.filter(l=>l!==s):[...r,s];n("allergies",a)},K=()=>S(!0),U=()=>{S(!1),H()},W=s=>{s.preventDefault(),B(route("pharmacist.doctors.store"),{onSuccess:()=>{U(),m.success("Doctor added successfully!"),window.location.reload()},onError:r=>{console.error("Failed to add doctor:",r),m.error("Failed to add doctor. Please try again.")}})},X=s=>{if(s.preventDefault(),!i.customer_id){m.error("Please select a customer.");return}if(!i.doctor_id){m.error("Please select a doctor.");return}if(!i.prescription_name.trim()){m.error("Please enter a prescription name.");return}const r=i.items.filter(a=>a.medication_id&&a.medication_id!=="");if(r.length===0){m.error("Please select at least one medication.");return}n("items",r),O(route("pharmacist.prescriptions.storeManual"),{onSuccess:()=>{m.success("Manual prescription created successfully!")},onError:a=>{console.error("Error creating prescription:",a);const l=a.error||"Failed to create prescription. Please check for errors.";m.error(l)}})},Z=[{title:"Prescriptions",href:route("pharmacist.prescriptions.index")},{title:"Create Manual Prescription",href:route("pharmacist.prescriptions.createManual")}];return e.jsxs(de,{breadcrumbs:Z,children:[e.jsx(re,{title:"Create Manual Prescription"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Create Manual Prescription"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Manually capture a prescription with patient, doctor, medication and notes."})]}),e.jsxs("form",{onSubmit:X,className:"max-w-5xl space-y-6",children:[e.jsxs(x,{className:"rounded-none",children:[e.jsxs(p,{children:[e.jsx(u,{children:"Customer Information"}),e.jsx(v,{children:"Select an existing customer or add a new one"})]}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(t,{htmlFor:"customer_select",children:"Select Customer"}),e.jsxs(f,{onValueChange:z,children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Choose a customer..."})}),e.jsx(b,{children:k.map(s=>e.jsxs(D,{value:s.id.toString(),children:[s.full_name," - ",s.email]},s.id))})]})]}),e.jsx(L,{href:route("pharmacist.customers.create"),children:e.jsxs(o,{type:"button",variant:"outline",className:"mt-6",children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Add New Customer"]})})]}),h&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 rounded-lg border border-green-200 bg-green-50 p-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"font-medium text-green-800",children:"ID Number"}),e.jsx("p",{className:"text-sm text-green-700",children:h.id_number})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium text-green-800",children:"Email"}),e.jsx("p",{className:"text-sm text-green-700",children:h.email})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium text-green-800",children:"First Name"}),e.jsx("p",{className:"text-sm text-green-700",children:h.name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium text-green-800",children:"Last Name"}),e.jsx("p",{className:"text-sm text-green-700",children:h.surname})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium text-green-800",children:"Cell Number"}),e.jsx("p",{className:"text-sm text-green-700",children:h.cellphone_number})]})]})]})})]}),e.jsxs(x,{className:"rounded-none",children:[e.jsxs(p,{children:[e.jsx(u,{children:"Allergies"}),e.jsx(v,{children:"Select customer allergy information"})]}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(t,{children:"Does the customer have any known allergies?"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"allergies_none",name:"allergies_type",value:"none",checked:i.allergies_type==="none",onChange:()=>{n("allergies_type","none"),n("allergies",[])}}),e.jsx(t,{htmlFor:"allergies_none",children:"No allergies"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"allergies_known",name:"allergies_type",value:"known",checked:i.allergies_type==="known",onChange:()=>n("allergies_type","known")}),e.jsx(t,{htmlFor:"allergies_known",children:"Yes, known allergies"})]})]}),i.allergies_type==="known"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Select allergens:"}),e.jsx("div",{className:"grid max-h-40 grid-cols-2 gap-2 overflow-y-auto",children:V.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{id:`allergy_${s.id}`,checked:i.allergies.includes(s.id),onCheckedChange:()=>J(s.id)}),e.jsx(t,{htmlFor:`allergy_${s.id}`,className:"text-sm",children:s.name})]},s.id))})]})]})})]}),e.jsxs(x,{className:"rounded-none",children:[e.jsxs(p,{children:[e.jsx(u,{children:"Prescribing Doctor"}),e.jsx(v,{children:"Select an existing doctor or add a new one"})]}),e.jsx(j,{className:"space-y-4",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(t,{children:"Select Doctor"}),e.jsxs(f,{onValueChange:s=>{n("doctor_id",s)},children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Choose a doctor..."})}),e.jsx(b,{children:R.map(s=>e.jsxs(D,{value:s.id.toString(),children:["Dr. ",s.name," ",s.surname," - ",s.practice_number]},s.id))})]})]}),e.jsxs(o,{type:"button",variant:"outline",className:"mt-6",onClick:K,children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Add New Doctor"]})]})})})]}),e.jsxs(x,{className:"rounded-none",children:[e.jsx(p,{children:e.jsx(u,{children:"Prescription Details"})}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Prescription Name"}),e.jsx(d,{value:i.prescription_name,onChange:s=>n("prescription_name",s.target.value),placeholder:"e.g., Monthly Medication"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Number of Repeats"}),e.jsxs(f,{onValueChange:s=>n("repeats_total",parseInt(s)),children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Select repeats..."})}),e.jsx(b,{children:[0,1,2,3,4,5].map(s=>e.jsxs(D,{value:s.toString(),children:[s," ",s===1?"repeat":"repeats"]},s))})]})]})]})})]}),e.jsxs(x,{className:"rounded-none",children:[e.jsxs(p,{children:[e.jsx(u,{children:"Medication Information"}),e.jsx(v,{children:"Add medications to this prescription"})]}),e.jsxs(j,{className:"space-y-4",children:[i.items.map((s,r)=>e.jsxs("div",{className:"grid grid-cols-12 items-end gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx(t,{children:"Medication"}),e.jsxs(f,{onValueChange:a=>w(r,"medication_id",a),children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Select medication..."})}),e.jsx(b,{children:M.map(a=>e.jsxs(D,{value:a.id.toString(),children:[a.name," - R",a.current_sale_price]},a.id))})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(t,{children:"Quantity"}),e.jsx(d,{type:"number",min:"1",value:s.quantity,onChange:a=>w(r,"quantity",parseInt(a.target.value)||1)})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(t,{children:"Instructions"}),e.jsx(d,{value:s.instructions,onChange:a=>w(r,"instructions",a.target.value),placeholder:"e.g., Take twice daily"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(t,{children:"Price"}),e.jsxs("p",{className:"text-sm font-medium",children:["R",(s.price||0).toFixed(2)]})]}),e.jsx("div",{className:"col-span-1",children:e.jsx(o,{type:"button",variant:"outline",size:"sm",onClick:()=>Y(r),disabled:i.items.length===1,children:e.jsx(me,{className:"h-4 w-4"})})})]},r)),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(o,{type:"button",variant:"outline",onClick:Q,children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Add Medication"]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-lg font-semibold",children:["Total: R",G.toFixed(2)]})})]})]})]}),e.jsxs(x,{className:"rounded-none",children:[e.jsxs(p,{children:[e.jsx(u,{children:"Pharmacy Notes"}),e.jsx(v,{children:"Any additional notes or instructions"})]}),e.jsx(j,{children:e.jsx(oe,{value:i.pharmacy_notes,onChange:s=>n("pharmacy_notes",s.target.value),placeholder:"Enter any pharmacy notes or special instructions...",rows:3})})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(L,{href:route("pharmacist.prescriptions.index"),children:e.jsx(o,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(o,{type:"submit",disabled:F,children:F?"Creating...":"Approve Prescription"})]})]})]}),I&&e.jsx(te,{open:I,onOpenChange:S,children:e.jsxs(ie,{children:[e.jsx(ne,{children:e.jsx(le,{children:"Add New Doctor"})}),e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"doctor_name_modal",children:"First Name"}),e.jsx(d,{id:"doctor_name_modal",value:g.name,onChange:s=>N("name",s.target.value),required:!0}),c.name&&e.jsx("p",{className:"text-sm text-red-500",children:c.name})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"doctor_surname_modal",children:"Surname"}),e.jsx(d,{id:"doctor_surname_modal",value:g.surname,onChange:s=>N("surname",s.target.value),required:!0}),c.surname&&e.jsx("p",{className:"text-sm text-red-500",children:c.surname})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"doctor_email_modal",children:"Email"}),e.jsx(d,{id:"doctor_email_modal",type:"email",value:g.email,onChange:s=>N("email",s.target.value),required:!0}),c.email&&e.jsx("p",{className:"text-sm text-red-500",children:c.email})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"doctor_phone_modal",children:"Phone"}),e.jsx(d,{id:"doctor_phone_modal",type:"tel",value:g.phone,onChange:s=>N("phone",s.target.value),required:!0}),c.phone&&e.jsx("p",{className:"text-sm text-red-500",children:c.phone})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"doctor_practice_number_modal",children:"Practice Number"}),e.jsx(d,{id:"doctor_practice_number_modal",value:g.practice_number,onChange:s=>N("practice_number",s.target.value),required:!0}),c.practice_number&&e.jsx("p",{className:"text-sm text-red-500",children:c.practice_number})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(ce,{asChild:!0,children:e.jsx(o,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(o,{type:"submit",disabled:A,children:A?"Adding...":"Add Doctor"})]})]})]})})]})}export{ke as default};
