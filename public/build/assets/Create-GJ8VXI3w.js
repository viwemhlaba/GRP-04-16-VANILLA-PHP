import{m as R,r as q,j as e,L as D}from"./app-DD1_j264.js";import{H as k}from"./heading-dqUOBQxD.js";import{B as _}from"./createLucideIcon-CJXjctMu.js";import{I as l}from"./input-cZgy-9z1.js";import{L as r}from"./label-D4qny3wm.js";import{S as f,a as g,b,c as N,d as y}from"./select-8dGr2CsA.js";import{A as T}from"./app-layout-BjO8UPhY.js";import"./index-D6cg2Mm3.js";import"./index-CR58GS18.js";import"./index-Db2yqOI4.js";import"./app-logo-DcjKhG5i.js";import"./pill-BS0WEZWH.js";function K({prescriptionId:p,initialData:c,doctors:P,medications:u}){const a={customer_name:c.customer_name??"",prescription_name:c.prescription_name??"",delivery_method:c.delivery_method??"",upload_date:c.upload_date??"",pdf_url:c.pdf_url??"",patient_id_number:c.patient_id_number??"",doctor_id:c.doctor_id?c.doctor_id.toString():""},{data:o,setData:m,post:j,processing:S,errors:x,reset:v}=R({patient_id_number:a.patient_id_number,doctor_id:a.doctor_id,items:[]}),C=o.items.reduce((t,i)=>{const n=u.find(d=>d.id===i.medication_id);return n?t+i.quantity*n.current_sale_price:t},0);q.useEffect(()=>{o.items.length===0&&m("items",[{medication_id:null,quantity:1,instructions:""}])},[]);function h(t,i,n){const d=[...o.items];d[t]={...d[t],[i]:n},m("items",d)}function I(){m("items",[...o.items,{medication_id:null,quantity:1,instructions:""}])}function F(t){const i=o.items.filter((n,d)=>d!==t);m("items",i)}function L(t){if(!t.medication_id)return 0;const i=u.find(n=>n.id===t.medication_id);return i?t.quantity*i.current_sale_price:0}const w=t=>{t.preventDefault(),p?j(route("pharmacist.prescriptions.load",p),{onSuccess:()=>v()}):j(route("pharmacist.prescriptions.create"),{onSuccess:()=>v()})};return e.jsxs(T,{children:[e.jsx(D,{title:p?"Load Prescription":"Create Prescription"}),e.jsxs("div",{className:"mx-auto max-w-4xl p-4",children:[e.jsx(k,{title:p?"Load Prescription":"Create Prescription",description:"Review prescription details and complete additional information."}),e.jsxs("form",{onSubmit:w,className:"mt-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{className:"mb-1 block",children:"Prescription PDF"}),a.pdf_url?e.jsx("a",{href:a.pdf_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 underline",children:"View Uploaded PDF"}):e.jsx("span",{children:"No PDF uploaded"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Customer Name"}),e.jsx(l,{value:a.customer_name,disabled:!0})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Prescription Name"}),e.jsx(l,{value:a.prescription_name,disabled:!0})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Delivery Method"}),e.jsx(l,{value:a.delivery_method,disabled:!0})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Date of Upload"}),e.jsx(l,{value:a.upload_date?new Date(a.upload_date).toLocaleDateString():"",disabled:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"patient_id",children:"Patient ID Number"}),e.jsx(l,{id:"patient_id_number",value:o.patient_id_number,onChange:t=>m("patient_id_number",t.target.value)}),x.patient_id_number&&e.jsx("div",{className:"mt-1 text-sm text-red-500",children:x.patient_id_number})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Prescribing Doctor"}),e.jsxs(f,{value:o.doctor_id,onValueChange:t=>m("doctor_id",t),children:[e.jsx(g,{children:e.jsx(b,{placeholder:"Select a doctor"})}),e.jsx(N,{children:P.map(t=>e.jsx(y,{value:t.id.toString(),children:t.name},t.id))})]}),x.doctor_id&&e.jsx("div",{className:"mt-1 text-sm text-red-500",children:x.doctor_id})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold",children:"Prescription Items"}),o.items.map((t,i)=>{var n,d;return e.jsxs("div",{className:"mb-4 grid grid-cols-12 items-center gap-4",children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx(r,{children:"Medication"}),e.jsxs(f,{value:t.medication_id?t.medication_id.toString():"",onValueChange:s=>h(i,"medication_id",parseInt(s)),children:[e.jsx(g,{children:e.jsx(b,{placeholder:"Select medication"})}),t.medication_id&&e.jsxs("div",{className:"text-muted-foreground mt-1 text-sm",children:[(n=u.find(s=>s.id===t.medication_id))==null?void 0:n.name," â€” R",(d=u.find(s=>s.id===t.medication_id))==null?void 0:d.current_sale_price.toFixed(2)]}),e.jsx(N,{children:u.map(s=>e.jsxs(y,{value:s.id.toString(),children:[s.name," ",typeof s.current_sale_price=="number"?`(R${s.current_sale_price.toFixed(2)})`:""]},s.id))})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(r,{children:"Quantity"}),e.jsx(l,{type:"number",min:1,value:t.quantity,onChange:s=>h(i,"quantity",Math.max(1,parseInt(s.target.value)||1))})]}),e.jsxs("div",{className:"col-span-4",children:[e.jsx(r,{children:"Instructions"}),e.jsx(l,{value:t.instructions,onChange:s=>h(i,"instructions",s.target.value),placeholder:"e.g. Take twice daily after meals"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(r,{children:"Total Price"}),e.jsxs("div",{className:"pt-2 font-semibold",children:["R",L(t).toFixed(2)]})]}),e.jsx("div",{className:"col-span-1 flex items-end",children:e.jsx(_,{type:"button",variant:"destructive",onClick:()=>F(i),className:"h-8 px-2",children:"Remove"})})]},i)}),e.jsx(_,{type:"button",onClick:I,children:"+ Add Medication Item"})]}),e.jsxs("div",{className:"mt-6 text-right text-lg font-semibold",children:["Total Prescription Cost: R",C.toFixed(2)]}),e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx(_,{type:"submit",disabled:S,children:"Save Prescription Details"})})]})]})]})}export{K as default};
