import{r as N,m as z,j as e,L as B,$ as C}from"./app-DD1_j264.js";import{H as U}from"./heading-dqUOBQxD.js";import{a as R,B as c}from"./createLucideIcon-CJXjctMu.js";import{C as m,a as x,b as h,c as g,d as u}from"./card-DMpxeHKD.js";import{I as o}from"./input-cZgy-9z1.js";import{L as l}from"./label-D4qny3wm.js";import{S as P,a as F,b as D,c as I,d as S}from"./select-8dGr2CsA.js";import{T as H}from"./textarea-3mhvGArJ.js";import{A as V,t as y}from"./app-layout-BjO8UPhY.js";import{U as W}from"./upload-D1m6XBpD.js";import"./index-D6cg2Mm3.js";import"./index-CR58GS18.js";import"./index-Db2yqOI4.js";import"./app-logo-DcjKhG5i.js";import"./pill-BS0WEZWH.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],O=R("ArrowLeft",$);function le({doctors:w,medications:v}){const[p,k]=N.useState(null),[_,j]=N.useState(""),{data:i,setData:n,post:q,processing:b,errors:a}=z({prescription_date:new Date().toISOString().split("T")[0],patient_id_number:"",doctor_id:"",pdf_file:null,items:[{medication_id:null,quantity:1,instructions:""}],repeats:0,notes:""}),A=s=>{var t;const r=(t=s.target.files)==null?void 0:t[0];if(j(""),!!r){if(r.type!=="application/pdf"){j("Please upload a PDF file only.");return}if(r.size>5*1024*1024){j("File size must be less than 5MB.");return}k(r),n("pdf_file",r)}},M=()=>{n("items",[...i.items,{medication_id:null,quantity:1,instructions:""}])},L=s=>{const r=i.items.filter((t,d)=>d!==s);n("items",r)},f=(s,r,t)=>{const d=[...i.items];d[s]={...d[s],[r]:t},n("items",d)},E=i.items.reduce((s,r)=>{if(!r.medication_id)return s;const t=v.find(d=>d.id===r.medication_id);return s+(t?t.current_sale_price*r.quantity:0)},0),T=s=>{if(s.preventDefault(),i.items.filter(t=>t.medication_id&&t.quantity>0).length===0){y.error("Please add at least one medication.");return}q(route("pharmacist.prescriptions.createWithPdf"),{forceFormData:!0,onSuccess:()=>{y.success("Prescription created successfully!")},onError:()=>{y.error("Failed to create prescription. Please try again.")}})};return e.jsxs(V,{children:[e.jsx(B,{title:"Create Prescription with PDF"}),e.jsxs("div",{className:"mx-auto max-w-4xl space-y-6 px-4 py-6 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{href:route("pharmacist.prescriptions.index"),children:e.jsx(c,{variant:"ghost",size:"sm",children:e.jsx(O,{className:"h-4 w-4"})})}),e.jsx(U,{title:"Create Prescription from PDF",description:"Upload a prescription PDF and enter medication details."})]}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Upload Prescription PDF"}),e.jsx(g,{children:"Upload the prescription PDF file (PDF only, max 5MB)"})]}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsxs("label",{htmlFor:"pdf-upload",className:"flex h-32 w-full cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 hover:bg-gray-100 dark:border-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(W,{className:"mb-4 h-8 w-8 text-gray-500 dark:text-gray-400"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold",children:"Click to upload"})," prescription PDF"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PDF only (MAX. 5MB)"})]}),e.jsx("input",{id:"pdf-upload",type:"file",className:"hidden",accept:".pdf",onChange:A,required:!0})]})}),p&&e.jsx("div",{className:"rounded-md border border-green-200 bg-green-50 p-3",children:e.jsxs("p",{className:"text-sm text-green-700",children:["âœ“ ",p.name," (",(p.size/1024/1024).toFixed(2)," MB)"]})}),_&&e.jsx("p",{className:"text-sm text-red-600",children:_}),a.pdf_file&&e.jsx("p",{className:"text-sm text-red-600",children:a.pdf_file})]})})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Prescription Details"}),e.jsx(g,{children:"Enter the prescription information"})]}),e.jsx(u,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"prescription_date",children:"Prescription Date"}),e.jsx(o,{id:"prescription_date",type:"date",value:i.prescription_date,onChange:s=>n("prescription_date",s.target.value),required:!0}),a.prescription_date&&e.jsx("p",{className:"text-sm text-red-600",children:a.prescription_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"patient_id_number",children:"Patient ID Number"}),e.jsx(o,{id:"patient_id_number",type:"text",value:i.patient_id_number,onChange:s=>n("patient_id_number",s.target.value),placeholder:"Enter patient ID number",required:!0}),a.patient_id_number&&e.jsx("p",{className:"text-sm text-red-600",children:a.patient_id_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"doctor_id",children:"Prescribing Doctor"}),e.jsxs(P,{value:i.doctor_id,onValueChange:s=>n("doctor_id",s),children:[e.jsx(F,{children:e.jsx(D,{placeholder:"Select a doctor"})}),e.jsx(I,{children:w.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]}),a.doctor_id&&e.jsx("p",{className:"text-sm text-red-600",children:a.doctor_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"repeats",children:"Number of Repeats"}),e.jsx(o,{id:"repeats",type:"number",min:"0",max:"5",value:i.repeats,onChange:s=>n("repeats",parseInt(s.target.value)||0)}),a.repeats&&e.jsx("p",{className:"text-sm text-red-600",children:a.repeats})]})]})})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Medications"}),e.jsx(g,{children:"Add medications prescribed"})]}),e.jsxs(u,{className:"space-y-4",children:[i.items.map((s,r)=>e.jsxs("div",{className:"grid grid-cols-12 gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"col-span-12 sm:col-span-5",children:[e.jsx(l,{children:"Medication"}),e.jsxs(P,{value:s.medication_id?s.medication_id.toString():"",onValueChange:t=>f(r,"medication_id",parseInt(t)),children:[e.jsx(F,{children:e.jsx(D,{placeholder:"Select medication"})}),e.jsx(I,{children:v.map(t=>e.jsxs(S,{value:t.id.toString(),children:[t.name," (R",t.current_sale_price.toFixed(2),")"]},t.id))})]})]}),e.jsxs("div",{className:"col-span-12 sm:col-span-2",children:[e.jsx(l,{children:"Quantity"}),e.jsx(o,{type:"number",min:"1",value:s.quantity,onChange:t=>f(r,"quantity",parseInt(t.target.value)||1)})]}),e.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[e.jsx(l,{children:"Instructions"}),e.jsx(o,{value:s.instructions,onChange:t=>f(r,"instructions",t.target.value),placeholder:"Take twice daily after meals"})]}),e.jsx("div",{className:"col-span-12 flex items-end sm:col-span-1",children:e.jsx(c,{type:"button",variant:"destructive",size:"sm",onClick:()=>L(r),disabled:i.items.length===1,children:"Remove"})})]},r)),e.jsx(c,{type:"button",onClick:M,variant:"outline",children:"+ Add Medication"}),e.jsxs("div",{className:"text-right text-lg font-semibold",children:["Total Cost: R",E.toFixed(2)]})]})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsx(h,{children:"Additional Notes"})}),e.jsxs(u,{children:[e.jsx(H,{value:i.notes,onChange:s=>n("notes",s.target.value),placeholder:"Add any additional notes or observations...",rows:4}),a.notes&&e.jsx("p",{className:"text-sm text-red-600",children:a.notes})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(c,{asChild:!0,variant:"outline",children:e.jsx(C,{href:route("pharmacist.prescriptions.index"),children:"Cancel"})}),e.jsx(c,{type:"submit",disabled:b||!p,children:b?"Creating...":"Create Prescription"})]})]})]})]})}export{le as default};
