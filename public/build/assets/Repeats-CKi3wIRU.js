import{r as n,j as e,L as E}from"./app-DD1_j264.js";import{B as A}from"./badge-PeB8ie60.js";import{a as H,B as N}from"./createLucideIcon-CJXjctMu.js";import{C as h,d as p,a as O,b as X,c as B}from"./card-DMpxeHKD.js";import{D as M,a as F,b as $,c as z,d as W,e as G}from"./dialog-BWut1jda.js";import{L as J}from"./label-D4qny3wm.js";import{T as K,a as I,b as w,c as l,d as Q,e as d}from"./table-Bx2kdRqw.js";import{T as U}from"./textarea-3mhvGArJ.js";import{A as V,t as m}from"./app-layout-BjO8UPhY.js";import{C as Y}from"./clock-KGfhU19J.js";import{C as Z}from"./circle-x-CkdvlzDH.js";import"./index-D6cg2Mm3.js";import"./index-CR58GS18.js";import"./app-logo-DcjKhG5i.js";import"./pill-BS0WEZWH.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],se=H("CircleCheckBig",ee);function fe(){const[R,x]=n.useState([]),[T,q]=n.useState(!0),[C,_]=n.useState(null),[k,j]=n.useState(!1),[i,y]=n.useState(null),[f,v]=n.useState(""),[u,g]=n.useState(!1);n.useEffect(()=>{(async()=>{try{const t=await fetch("/api/pharmacist/requested-repeats",{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();r.success&&r.data?x(r.data):x([])}catch(t){console.error("Error fetching repeats:",t),_(t instanceof Error?t.message:"Failed to load repeats")}finally{q(!1)}})()},[]);const b=async(s,t)=>{var r;if(t==="reject"){const a=R.find(c=>c.id===s);a&&(y(a),j(!0));return}g(!0);try{const a=(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"),c=await fetch(`/api/pharmacist/repeats/${s}/dispense`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":a||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({})});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const o=await c.json();o.success?o.redirect_url?window.location.href=o.redirect_url:(x(P=>P.filter(L=>L.id!==s)),m.success(o.message)):m.error(o.message||"Action failed")}catch(a){console.error("Error:",a),m.error("Network error occurred. Please try again.")}finally{g(!1)}},D=async()=>{var s;if(!i||!f.trim()){m.error("Please provide a rejection note");return}g(!0);try{const t=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"),r=await fetch(`/api/pharmacist/repeats/${i.id}/reject`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":t||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({note:f})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const a=await r.json();a.success?(x(c=>c.filter(o=>o.id!==i.id)),m.success(a.message||"Repeat request rejected successfully"),j(!1),y(null),v("")):m.error(a.message||"Rejection failed")}catch(t){console.error("Error:",t),m.error("Network error occurred. Please try again.")}finally{g(!1)}},S=[{title:"Prescriptions",href:route("pharmacist.prescriptions.index")},{title:"Requested Repeats",href:route("pharmacist.repeats")}];return e.jsxs(V,{breadcrumbs:S,children:[e.jsx(E,{title:"Requested Repeats"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Requested Repeats"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Review, approve, or reject repeat medication requests from customers."})]}),T?e.jsx(h,{className:"rounded-none",children:e.jsx(p,{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 animate-spin"}),"Loading repeat requests..."]})})}):C?e.jsx(h,{className:"rounded-none",children:e.jsx(p,{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(Z,{className:"h-4 w-4"}),C]})})}):R.length===0?e.jsx(h,{className:"rounded-none",children:e.jsx(p,{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"No repeat requests at this time."]})})}):e.jsxs(h,{className:"rounded-none",children:[e.jsxs(O,{children:[e.jsx(X,{children:"Pending Repeat Requests"}),e.jsx(B,{children:"Review each request carefully before approving or rejecting."})]}),e.jsx(p,{children:e.jsx("div",{className:"overflow-x-auto rounded-lg border",children:e.jsxs(K,{children:[e.jsx(I,{children:e.jsxs(w,{children:[e.jsx(l,{children:"Customer"}),e.jsx(l,{children:"Prescription"}),e.jsx(l,{children:"Doctor"}),e.jsx(l,{children:"Requested On"}),e.jsx(l,{children:"Repeats"}),e.jsx(l,{children:"Next Due"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(Q,{children:R.map(s=>e.jsxs(w,{children:[e.jsxs(d,{children:[e.jsxs("div",{className:"font-medium",children:[s.customer_name," ",s.customer_surname]}),e.jsxs("div",{className:"text-muted-foreground text-sm",children:["ID: ",s.patient_id_number]})]}),e.jsxs(d,{children:[e.jsx("div",{className:"font-medium",children:s.prescription_name}),e.jsx("div",{className:"text-muted-foreground text-sm",children:s.delivery_method==="pickup"?"Pick up":"Dispense"})]}),e.jsx(d,{children:s.doctor_name}),e.jsx(d,{children:new Date(s.request_date).toLocaleDateString()}),e.jsx(d,{children:e.jsxs(A,{variant:"outline",children:[s.repeats_used,"/",s.repeats_total]})}),e.jsx(d,{children:s.next_repeat_date?e.jsx("span",{className:"text-sm",children:new Date(s.next_repeat_date).toLocaleDateString()}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"N/A"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{size:"sm",variant:"default",onClick:()=>b(s.id,"dispense"),disabled:u,children:"Approve"}),e.jsx(N,{size:"sm",variant:"destructive",onClick:()=>b(s.id,"reject"),disabled:u,children:"Reject"})]})})]},s.id))})]})})})]}),e.jsx(h,{className:"rounded-none",children:e.jsx(p,{className:"pt-6",children:e.jsxs("div",{className:"text-muted-foreground text-sm",children:[e.jsx("strong",{children:"Guidelines:"})," Reject if too soon after last dispense, for medical concerns, or incomplete documentation. Provide a clear reason."]})})})]}),e.jsx(M,{open:k,onOpenChange:j,children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(z,{children:"Reject Repeat Request"}),e.jsx(W,{children:"Please provide a reason for rejecting this repeat request. This will be communicated to the customer."})]}),i&&e.jsx("div",{className:"bg-muted my-4 rounded-lg p-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Customer:"})," ",i.customer_name," ",i.customer_surname,e.jsx("br",{}),e.jsx("strong",{children:"Prescription:"})," ",i.prescription_name,e.jsx("br",{}),e.jsx("strong",{children:"Requested:"})," ",new Date(i.request_date).toLocaleDateString()]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"rejection-note",children:"Rejection Reason *"}),e.jsx(U,{id:"rejection-note",placeholder:"Please explain why this repeat request is being rejected...",value:f,onChange:s=>v(s.target.value),className:"min-h-[100px]"})]}),e.jsxs(G,{children:[e.jsx(N,{variant:"outline",onClick:()=>{j(!1),y(null),v("")},disabled:u,children:"Cancel"}),e.jsx(N,{variant:"destructive",onClick:D,disabled:u||!f.trim(),children:u?"Rejecting...":"Confirm Rejection"})]})]})})]})}export{fe as default};
