import{r as k,j as e,L as H,S as B}from"./app-DD1_j264.js";import{B as b}from"./badge-PeB8ie60.js";import{B as N}from"./createLucideIcon-CJXjctMu.js";import{C as v,a as w,b as S,c as C,d as R}from"./card-DMpxeHKD.js";import{C as E}from"./checkbox-CmdZUS2u.js";import{L as i}from"./label-D4qny3wm.js";import{S as x,a as h,b as p,c as u,d as t}from"./select-8dGr2CsA.js";import{T as U,a as I,b as D,c as d,d as V,e as m}from"./table-Bx2kdRqw.js";import{A as q,F,t as l}from"./app-layout-BjO8UPhY.js";import{T as L}from"./index-CtBsO7PD.js";import{C as M}from"./clock-KGfhU19J.js";import{C as $}from"./calendar-BYUAldzQ.js";import{D as X}from"./download-C1qKmiEZ.js";import"./index-CR58GS18.js";import"./index-Db2yqOI4.js";import"./index-D6cg2Mm3.js";import"./app-logo-DcjKhG5i.js";import"./pill-BS0WEZWH.js";function xe({recentReports:g}){const[r,T]=k.useState({group_by:"dosage_form",stock_filter:"all",include_zero_stock:!1,sort_by:"name",sort_direction:"asc"}),[f,_]=k.useState(!1),n=(s,c)=>{T(a=>({...a,[s]:c}))},G=async()=>{_(!0);try{const s=new URLSearchParams({group_by:r.group_by,stock_filter:r.stock_filter,include_zero_stock:r.include_zero_stock.toString(),sort_by:r.sort_by,sort_direction:r.sort_direction}),c=L("manager.reports.stock.generate")+"?"+s.toString(),a=await fetch(c,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!a.ok){const j=await a.json();a.status===404?l.error(j.message,{description:j.details,duration:5e3}):a.status===422?l.error(j.message,{description:"Please check your input parameters and try again.",duration:5e3}):a.status===401||a.status===403?l.error("Not authorized",{description:"Please make sure you are logged in as a manager.",duration:5e3}):l.error("Failed to generate report",{description:"An unexpected error occurred. Please try again.",duration:5e3});return}const P=await a.blob(),y=window.URL.createObjectURL(P),o=document.createElement("a");o.href=y,o.download=`stock-report-${r.group_by}-${r.stock_filter}-${new Date().toISOString().split("T")[0]}.pdf`,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(y),l.success("Stock report generated and downloaded successfully!",{description:"The PDF file has been saved to your downloads folder.",duration:3e3}),setTimeout(()=>{B.reload({only:["recentReports"]})},2e3)}catch(s){console.error("Error generating report:",s),l.error("Failed to generate report",{description:"An unexpected error occurred. Please try again.",duration:5e3})}finally{_(!1)}},z=s=>{window.open(L("manager.reports.stock.download",s),"_blank")},A=s=>({all:"All Medications",low_stock:"Low Stock Only",out_of_stock:"Out of Stock Only"})[s]||s,O=s=>({dosage_form:"Dosage Form",schedule:"Schedule",supplier:"Supplier"})[s]||s;return e.jsxs(q,{breadcrumbs:[{title:"Reports",href:"/manager/reports"},{title:"Stock",href:"/manager/reports/stock"}],children:[e.jsx(H,{title:"Stock Reports"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-6 rounded-xl p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(v,{className:"rounded-none",children:[e.jsxs(w,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Generate New Report"]}),e.jsx(C,{children:"Generate detailed medication stock reports for inventory management and stock take."})]}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"group_by",children:"Group medications by"}),e.jsxs(x,{value:r.group_by,onValueChange:s=>n("group_by",s),children:[e.jsx(h,{className:"bg-transparent",children:e.jsx(p,{placeholder:"Select grouping method"})}),e.jsxs(u,{children:[e.jsx(t,{value:"dosage_form",children:"Dosage Form"}),e.jsx(t,{value:"schedule",children:"Schedule"}),e.jsx(t,{value:"supplier",children:"Supplier"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"stock_filter",children:"Stock filter"}),e.jsxs(x,{value:r.stock_filter,onValueChange:s=>n("stock_filter",s),children:[e.jsx(h,{className:"bg-transparent",children:e.jsx(p,{placeholder:"Select stock filter"})}),e.jsxs(u,{children:[e.jsx(t,{value:"all",children:"All Medications"}),e.jsx(t,{value:"low_stock",children:"Low Stock Only"}),e.jsx(t,{value:"out_of_stock",children:"Out of Stock Only"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"sort_by",children:"Sort by"}),e.jsxs(x,{value:r.sort_by,onValueChange:s=>n("sort_by",s),children:[e.jsx(h,{className:"bg-transparent",children:e.jsx(p,{placeholder:"Select sort field"})}),e.jsxs(u,{children:[e.jsx(t,{value:"name",children:"Medication Name"}),e.jsx(t,{value:"quantity_on_hand",children:"Quantity on Hand"}),e.jsx(t,{value:"reorder_level",children:"Reorder Level"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"sort_direction",children:"Sort direction"}),e.jsxs(x,{value:r.sort_direction,onValueChange:s=>n("sort_direction",s),children:[e.jsx(h,{className:"bg-transparent",children:e.jsx(p,{placeholder:"Select sort direction"})}),e.jsxs(u,{children:[e.jsx(t,{value:"asc",children:"Ascending (A-Z, Low-High)"}),e.jsx(t,{value:"desc",children:"Descending (Z-A, High-Low)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"include_zero_stock",checked:r.include_zero_stock,onCheckedChange:s=>n("include_zero_stock",!!s)}),e.jsx(i,{htmlFor:"include_zero_stock",className:"text-sm",children:"Include zero stock items"})]}),e.jsx(N,{onClick:G,disabled:f,className:"w-full",children:f?"Generating...":"Generate PDF Report"})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(v,{className:"rounded-none",children:[e.jsxs(w,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Recent Reports"]}),e.jsx(C,{children:"Your most recent generated stock reports."})]}),e.jsx(R,{children:g.length===0?e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx(F,{className:"mx-auto mb-4 h-12 w-12 text-gray-300"}),e.jsx("p",{children:"No reports generated yet."}),e.jsx("p",{className:"text-sm",children:"Generate your first stock report using the form on the left."})]}):e.jsxs(U,{children:[e.jsx(I,{children:e.jsxs(D,{children:[e.jsx(d,{children:"Report"}),e.jsx(d,{children:"Parameters"}),e.jsx(d,{children:"Generated"}),e.jsx(d,{children:"Downloads"}),e.jsx(d,{className:"text-right",children:"Actions"})]})}),e.jsx(V,{children:g.map(s=>e.jsxs(D,{children:[e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500",children:s.file_size})]})}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(b,{variant:"outline",className:"text-xs",children:O(s.parameters.group_by)}),e.jsx(b,{variant:"outline",className:"text-xs",children:A(s.parameters.stock_filter)})]})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx($,{className:"h-4 w-4"}),s.generated_at]})}),e.jsx(m,{children:e.jsx("span",{className:"text-sm",children:s.download_count})}),e.jsxs(m,{className:"text-right",children:[e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>z(s.id),disabled:!s.file_exists||s.is_expired,className:"inline-flex items-center gap-1",children:[e.jsx(X,{className:"h-4 w-4"}),"Download"]}),!s.file_exists&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:"File not found"}),s.is_expired&&e.jsx("p",{className:"mt-1 text-xs text-yellow-500",children:"Expired"})]})]},s.id))})]})})]})})]})})]})}export{xe as default};
