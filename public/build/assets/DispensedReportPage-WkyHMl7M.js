import{r as S,m as P,j as e,L as F}from"./app-DD1_j264.js";import{B as p}from"./createLucideIcon-CJXjctMu.js";import{C as R,a as C,b as L,c as M,d as k}from"./card-DMpxeHKD.js";import{I as b}from"./input-cZgy-9z1.js";import{L as h}from"./label-D4qny3wm.js";import{S as O,a as G,b as I,c as q,d as x}from"./select-8dGr2CsA.js";import{A as E,t as o}from"./app-layout-BjO8UPhY.js";import"./index-D6cg2Mm3.js";import"./index-CR58GS18.js";import"./index-Db2yqOI4.js";import"./app-logo-DcjKhG5i.js";import"./pill-BS0WEZWH.js";function K(){const[g,f]=S.useState(!1),{data:a,setData:i,errors:c,processing:_}=P({start_date:"",end_date:"",group_by:"patient"}),w=async t=>{if(t.preventDefault(),!a.start_date||!a.end_date){o.error("Please select both start and end dates");return}if(new Date(a.start_date)>new Date(a.end_date)){o.error("Start date cannot be after end date");return}f(!0);try{const r=new URLSearchParams({start_date:a.start_date,end_date:a.end_date,group_by:a.group_by}),n=route("pharmacist.reports.dispensed-pdf")+"?"+r.toString(),d=await fetch(n,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!d.ok){const m=await d.json();d.status===404?o.error(m.message,{description:m.details,duration:5e3}):d.status===422?o.error(m.message,{description:"Please check your input parameters and try again.",duration:5e3}):o.error("Failed to generate report",{description:"An unexpected error occurred. Please try again.",duration:5e3});return}const u=await d.blob(),y=window.URL.createObjectURL(u),l=document.createElement("a");l.href=y,l.download=`dispensed-medications-report-${a.start_date}-to-${a.end_date}.pdf`,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(y),o.success("PDF report generated successfully",{description:"Your report has been downloaded.",duration:3e3})}catch(r){console.error("PDF generation error:",r),o.error("Failed to generate PDF report",{description:"Please check your connection and try again.",duration:5e3})}finally{f(!1)}},j=new Date().toISOString().split("T")[0],D=(t,r)=>{const n=new Date(t);return n.setDate(n.getDate()+r),n},s=t=>t.toISOString().split("T")[0],v=(()=>{const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),1),n=new Date(t.getFullYear(),t.getMonth()-1,1),d=new Date(t.getFullYear(),t.getMonth(),0),u=new Date(t.getFullYear(),0,1);return[{label:"Today",start:s(t),end:s(t)},{label:"Last 7 Days",start:s(D(t,-6)),end:s(t)},{label:"This Month",start:s(r),end:s(t)},{label:"Last Month",start:s(n),end:s(d)},{label:"Year to Date",start:s(u),end:s(t)}]})(),N=[{title:"Reports",href:route("pharmacist.reports")},{title:"Dispensed Report",href:route("pharmacist.reports.dispensed")}];return e.jsxs(E,{breadcrumbs:N,children:[e.jsx(F,{title:"Dispensed Report"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Dispensed Medication Report"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Generate a PDF report for a specific date range of all medication dispensed by you. Group by patient, medication, or schedule."})]}),e.jsxs(R,{className:"max-w-4xl rounded-none",children:[e.jsxs(C,{children:[e.jsx(L,{className:"text-lg font-medium",children:"Report Parameters"}),e.jsx(M,{children:"Select a date range and grouping option, then generate the PDF."})]}),e.jsx(k,{children:e.jsxs("form",{onSubmit:w,className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[v.map(t=>e.jsx(p,{type:"button",variant:a.start_date===t.start&&a.end_date===t.end?"default":"outline",size:"sm",onClick:()=>i({...a,start_date:t.start,end_date:t.end}),children:t.label},t.label)),e.jsx(p,{type:"button",size:"sm",variant:"outline",onClick:()=>i({...a,start_date:"",end_date:""}),children:"Custom"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"start_date",children:"Start Date"}),e.jsx(b,{id:"start_date",type:"date",value:a.start_date,onChange:t=>i("start_date",t.target.value),max:j,required:!0}),c.start_date&&e.jsx("p",{className:"text-sm text-red-500",children:c.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"end_date",children:"End Date"}),e.jsx(b,{id:"end_date",type:"date",value:a.end_date,onChange:t=>i("end_date",t.target.value),max:j,required:!0}),c.end_date&&e.jsx("p",{className:"text-sm text-red-500",children:c.end_date})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"group_by",children:"Group Report By"}),e.jsxs(O,{value:a.group_by,onValueChange:t=>i("group_by",t),children:[e.jsx(G,{children:e.jsx(I,{placeholder:"Select grouping method"})}),e.jsxs(q,{children:[e.jsx(x,{value:"patient",children:"Patient"}),e.jsx(x,{value:"medication",children:"Medication"}),e.jsx(x,{value:"schedule",children:"Schedule"})]})]}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:[a.group_by==="patient"&&"Each patient with their dispensed medications",a.group_by==="medication"&&"Each medication with total quantities and patients",a.group_by==="schedule"&&"Grouped under medication schedule classifications"]})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-2 sm:flex-row",children:[e.jsx(p,{type:"submit",disabled:g||_,className:"w-full sm:w-auto",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-white border-b-transparent"}),"Generating PDF..."]}):"Generate PDF Report"}),e.jsx(p,{type:"button",variant:"outline",onClick:()=>i({start_date:"",end_date:"",group_by:"patient"}),className:"w-full sm:w-auto",children:"Reset"})]}),e.jsxs("div",{className:"bg-muted/30 rounded-md border p-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"About this report"}),e.jsxs("ul",{className:"text-muted-foreground mt-2 list-inside list-disc space-y-1 text-xs",children:[e.jsx("li",{children:"Includes only medications you personally dispensed."}),e.jsx("li",{children:"Shows: date, medication, quantity, patient, doctor, schedule."}),e.jsx("li",{children:"PDF downloads automatically if data exists for the range."}),e.jsx("li",{children:"Receive a clear message if no records match the filters."})]})]})]})})]})]})]})}export{K as default};
