import{r as a,m as w,j as e,L as G,$ as S}from"./app-DD1_j264.js";import{H as J}from"./heading-dqUOBQxD.js";import{B as K}from"./badge-PeB8ie60.js";import{B as u}from"./createLucideIcon-CJXjctMu.js";import{D,a as C,b as P,c as R}from"./dialog-BWut1jda.js";import{I as h}from"./input-cZgy-9z1.js";import{L as k}from"./label-D4qny3wm.js";import{T as Q,a as W,b as E,c as i,d as X,e as n}from"./table-Bx2kdRqw.js";import{A as Z,t as c}from"./app-layout-BjO8UPhY.js";import"./index-D6cg2Mm3.js";import"./index-CR58GS18.js";import"./app-logo-DcjKhG5i.js";import"./pill-BS0WEZWH.js";const ee=l=>{const j={pending:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",approved:"bg-blue-100 text-blue-800 hover:bg-blue-200",dispensed:"bg-green-100 text-green-800 hover:bg-green-200",rejected:"bg-red-100 text-red-800 hover:bg-red-200"};return e.jsx(K,{className:j[l]||"bg-gray-100 text-gray-800",children:l.charAt(0).toUpperCase()+l.slice(1)})};function ue({prescriptions:l}){const[j,p]=a.useState(!1),[N,F]=a.useState(null),[g,L]=a.useState(""),[m,M]=a.useState(""),[o,A]=a.useState(""),{data:H,setData:f,put:O,processing:T,reset:b,errors:x}=w({name:"",prescription_file:null}),q=w({}),[B,y]=a.useState(!1),[r,I]=a.useState(null),U=s=>{q.post(route("customer.prescriptions.request-repeat",{prescription:s}),{preserveScroll:!0,onSuccess:()=>{c.success("Repeat requested successfully.")},onError:()=>{c.error("Could not request repeat.")}})},v=s=>{if(!s)return!1;const t=new Date().toISOString().slice(0,10);return s<t};function $(s,t){if(!t)return"N/A";const d=new Date(t);return d.setDate(d.getDate()-30*(s+1)),d.toLocaleDateString()}const z=s=>{F(s),f({name:s.name,prescription_file:null}),p(!0)},V=s=>{s.preventDefault(),N&&O(route("customer.prescriptions.update",N.id),{forceFormData:!0,onSuccess:()=>{c.success("Prescription updated"),p(!1),b()},onError:t=>{t.prescription_file||t.name?c.error("Please fix the validation errors."):c.error("Something went wrong."),p(!1),b()}})},_=l.filter(s=>{const t=s.name.toLowerCase().includes(g.toLowerCase())||s.status.toLowerCase().includes(g.toLowerCase()),d=m?s.status===m:!0,Y=o?new Date(s.created_at).toISOString().slice(0,10)===o:!0;return t&&d&&Y});return e.jsxs(Z,{children:[e.jsx(G,{title:"My Prescriptions"}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx(J,{title:"My Prescriptions",description:"View your uploaded prescriptions and track their status."}),e.jsx(u,{asChild:!0,children:e.jsx(S,{href:route("customer.prescriptions.create"),children:"Upload New"})}),e.jsx(u,{asChild:!0,variant:"secondary",children:e.jsx("a",{href:route("customer.prescriptions.export",{status:m,from_date:o,to_date:o}),target:"_blank",rel:"noopener noreferrer",children:"Export PDF"})})]}),e.jsxs("div",{className:"mb-4 grid max-w-4xl grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(h,{type:"text",placeholder:"Search by name or status...",value:g,onChange:s=>L(s.target.value)}),e.jsxs("select",{className:"rounded-md border px-3 py-2 text-sm text-gray-800 dark:border-gray-700 dark:bg-gray-900 dark:text-white",value:m,onChange:s=>M(s.target.value),children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"dispensed",children:"Dispensed"})]}),e.jsx(h,{type:"date",value:o,onChange:s=>A(s.target.value)})]}),_.length===0?e.jsx("p",{className:"text-muted-foreground text-sm",children:"No matching prescriptions found."}):e.jsx("div",{className:"overflow-x-auto rounded-lg border",children:e.jsxs(Q,{className:"w-full",children:[e.jsx(W,{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs(E,{children:[e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Date Uploaded"}),e.jsx(i,{children:"Delivery Method"}),e.jsx(i,{children:"Repeats"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(X,{children:_.map(s=>e.jsxs(E,{className:v(s.next_repeat_date)?"bg-red-50 dark:bg-red-900/30":"",children:[e.jsx(n,{children:s.name}),e.jsx(n,{children:ee(s.status)}),e.jsx(n,{children:new Date(s.created_at).toLocaleString()}),e.jsxs(n,{className:"capitalize",children:[s.delivery_method==="pickup"&&"Pick up",s.delivery_method==="dispense"&&"Dispense",!s.delivery_method&&"Not specified"]}),e.jsx(n,{className:"space-y-1 text-sm",children:s.repeats_total>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[s.repeats_used," of ",s.repeats_total," used"]}),e.jsxs("div",{className:v(s.next_repeat_date)?"font-semibold text-red-600":"text-muted-foreground",children:["Next: ",s.next_repeat_date??"N/A"]}),v(s.next_repeat_date)&&e.jsx("div",{className:"text-sm text-red-600",children:"⚠️ Your repeat is overdue. Please request a repeat or contact the pharmacy."}),s.repeats_used<s.repeats_total&&e.jsx(u,{size:"sm",variant:"outline",onClick:()=>U(s.id),className:"mt-1",children:"Request Repeat"}),s.status==="repeat_pending"&&e.jsx("div",{className:"text-xs font-medium text-yellow-600",children:"Repeat request pending approval"})]}):e.jsx("span",{className:"text-muted-foreground italic",children:"No repeats"})}),e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx("a",{href:`/storage/${s.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline",children:"View"}),e.jsx("button",{onClick:()=>z(s),className:"text-sm text-yellow-600 hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>{I(s),y(!0)},className:"text-sm text-sky-600 hover:underline",children:"History"}),e.jsx(S,{as:"button",method:"delete",href:route("customer.prescriptions.destroy",s.id),className:"text-sm text-red-600 hover:underline",preserveScroll:!0,children:"Delete"})]})]},s.id))})]})})]}),e.jsx(D,{open:j,onOpenChange:p,children:e.jsxs(C,{className:"max-w-lg",children:[e.jsx(P,{children:e.jsx(R,{children:"Edit Prescription"})}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(k,{htmlFor:"name",children:"Prescription Name"}),e.jsx(h,{id:"name",value:H.name,onChange:s=>f("name",s.target.value)}),x.name&&e.jsx("p",{className:"text-sm text-red-500",children:x.name})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"prescription_file",children:"Replace File (optional)"}),e.jsx(h,{id:"prescription_file",type:"file",accept:".pdf,image/*",onChange:s=>{var t;return f("prescription_file",((t=s.target.files)==null?void 0:t[0])||null)}}),x.prescription_file&&e.jsx("p",{className:"text-sm text-red-500",children:x.prescription_file})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{type:"submit",disabled:T,children:"Save Changes"})})]})]})}),e.jsx(D,{open:B,onOpenChange:y,children:e.jsxs(C,{className:"max-w-md",children:[e.jsx(P,{children:e.jsx(R,{children:"Repeat History"})}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"flex items-center text-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Prescription Name:"}),e.jsx("span",{children:r.name})]})}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Status:"}),e.jsx("span",{children:r.status})]})}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Repeats Used:"}),e.jsxs("span",{children:[r.repeats_used," / ",r.repeats_total]})]})}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Next Repeat Date:"}),e.jsx("span",{children:r.next_repeat_date??"N/A"})]})})]}),e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"font-medium",children:"Past Repeats:"}),e.jsx("ul",{className:"space-y-2",children:Array.from({length:r.repeats_used}).map((s,t)=>e.jsxs("li",{className:"flex items-center gap-2 rounded-lg border p-3 text-sm",children:[e.jsxs("span",{className:"font-semibold",children:["Repeat #",t+1,":"]}),e.jsxs("span",{children:["Estimated date: ",$(t,r.next_repeat_date)]})]},t))})]})]})]})})]})}export{ue as default};
