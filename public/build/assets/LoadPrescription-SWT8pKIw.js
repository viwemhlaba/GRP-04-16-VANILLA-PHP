import{j as e,r as C,m as E,L as de,$ as oe}from"./app-DD1_j264.js";import{B as ce}from"./badge-PeB8ie60.js";import{B as d}from"./createLucideIcon-CJXjctMu.js";import{D as z,a as H,b as Q,c as W,d as me,e as he,f as ue}from"./dialog-BWut1jda.js";import{C as O,a as $,b as U,c as V,d as B}from"./card-DMpxeHKD.js";import{I as m}from"./input-cZgy-9z1.js";import{L as i}from"./label-D4qny3wm.js";import{S as D,a as w,b as S,c as k,d as N}from"./select-8dGr2CsA.js";import{T as xe}from"./textarea-3mhvGArJ.js";import{A as pe}from"./app-layout-BjO8UPhY.js";import"./index-D6cg2Mm3.js";import"./index-CR58GS18.js";import"./index-Db2yqOI4.js";import"./app-logo-DcjKhG5i.js";import"./pill-BS0WEZWH.js";const je=({isOpen:t,onClose:x,allergies:p,customerName:h})=>e.jsx(z,{open:t,onOpenChange:x,children:e.jsxs(H,{className:"sm:max-w-[425px]",children:[e.jsxs(Q,{children:[e.jsxs(W,{children:["Allergies for ",h]}),e.jsx(me,{children:"Review the active ingredients this customer is known to be allergic to."})]}),e.jsx("div",{className:"space-y-3 py-4",children:p.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(g=>e.jsx(ce,{variant:"destructive",className:"text-md px-3 py-1",children:g.active_ingredient_name},g.id))}):e.jsx("p",{className:"text-gray-500",children:"No known allergies for this customer."})}),e.jsx(he,{children:e.jsx(d,{onClick:x,children:"Close"})})]})}),Me=({prescription:t,doctors:x,medications:p,customerAllergies:h,existingPrescriptionItems:g,customers:b})=>{var M,q,A,R,L,T;const[G,P]=C.useState(!1),[F,f]=C.useState(!1),{data:n,setData:l,post:J,processing:j,errors:o}=E({_method:"put",customer_id:((M=t.user_id)==null?void 0:M.toString())||"",patient_id_number:t.patient_id_number||"",doctor_id:((q=t.doctor_id)==null?void 0:q.toString())||"",items:t.is_manual&&g.length>0?g:[{medication_id:null,quantity:1,instructions:""}],status:t.status,reason_for_rejection:t.reason_for_rejection||"",notes:"",repeats_total:t.repeats_total??0}),{data:_,setData:v,post:K,processing:X,errors:c,reset:Y}=E({name:"",surname:"",email:"",phone:"",practice_number:""}),Z=()=>f(!0),ee=()=>{f(!1),Y()},se=s=>{s.preventDefault(),K(route("pharmacist.doctors.store"),{onSuccess:()=>{ee(),window.location.reload()},onError:a=>{console.error("Failed to add doctor:",a)}})};C.useEffect(()=>{(!n.items||n.items.length===0)&&l("items",[{medication_id:null,quantity:1,instructions:""}])},[n.items,l]);const y=(s,a,r)=>{const u=[...n.items];u[s]={...u[s],[a]:r},l("items",u)},te=()=>{l("items",[...n.items,{medication_id:null,quantity:1,instructions:""}])},ae=s=>{const a=n.items.filter((r,u)=>u!==s);l("items",a)},I=s=>{if(!s.medication_id)return 0;const a=p.find(r=>r.id===s.medication_id);return a?s.quantity*a.current_sale_price:0},re=n.items.reduce((s,a)=>s+I(a),0),ie=s=>{if(!s.medication_id)return!1;const a=p.find(r=>r.id===s.medication_id);return!a||!a.active_ingredients?!1:a.active_ingredients.some(r=>h.some(u=>u.active_ingredient_id===r))},ne=s=>{s.preventDefault(),J(route("pharmacist.prescriptions.loadAction",{prescription:t.id}),{onSuccess:()=>{var a;console.log(`Prescription for ${((a=t.user)==null?void 0:a.name)??"Unknown"} has been updated.`)},onError:a=>{console.error("Error processing prescription:",a)}})},le=[{title:"Prescriptions",href:route("pharmacist.prescriptions.index")},{title:`Load #${t.id}`,href:route("pharmacist.prescriptions.load",t.id)}];return e.jsxs(pe,{breadcrumbs:le,children:[e.jsx(de,{title:`Load Prescription: ${t.id}`}),e.jsxs("div",{className:"max-w-4xl space-y-6 px-4 py-6 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h1",{className:"text-2xl font-semibold tracking-tight",children:["Prescription #",t.id]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Review and manage this prescription's details and status."})]}),e.jsxs(O,{className:"border-border/60 rounded-none border shadow-sm",children:[e.jsxs($,{children:[e.jsx(U,{children:"Prescription Overview"}),e.jsx(V,{children:"Details provided by the customer."})]}),e.jsx(B,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Customer Name"}),e.jsxs("p",{className:"font-medium",children:[((A=t.user)==null?void 0:A.name)??"Unknown"," ",((R=t.user)==null?void 0:R.surname)??""]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Prescription Name"}),e.jsx("p",{className:"font-medium",children:t.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Delivery Method"}),e.jsx("p",{className:"font-medium capitalize",children:t.delivery_method})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Upload Date"}),e.jsx("p",{className:"font-medium",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Current Status"}),e.jsx("p",{className:"font-medium capitalize",children:t.status})]}),t.file_path&&e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(i,{children:"Uploaded Prescription File"}),e.jsx("div",{className:"mt-2 rounded-md border bg-gray-50 p-2 dark:bg-gray-800",children:e.jsx("a",{href:`/storage/${t.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline dark:text-blue-400",children:"View Uploaded File"})})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(d,{type:"button",onClick:()=>P(!0),variant:h.length>0?"destructive":"outline",className:"w-full",children:h.length>0?e.jsxs(e.Fragment,{children:["Customer has ",h.length," known Allergies! View Details"]}):e.jsx(e.Fragment,{children:"No known allergies for this customer."})})})]})})]}),e.jsxs(O,{className:"border-border/60 rounded-none border shadow-sm",children:[e.jsxs($,{children:[e.jsx(U,{children:"Pharmacist Processing"}),e.jsx(V,{children:"Complete the prescription details for approval or dispensing."})]}),e.jsx(B,{children:e.jsxs("form",{onSubmit:ne,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"patient_id_number",children:"Patient ID Number"}),e.jsx(m,{id:"patient_id_number",type:"text",value:n.patient_id_number,onChange:s=>l("patient_id_number",s.target.value),required:!0}),o.patient_id_number&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.patient_id_number})]}),t.is_manual&&b&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"customer_id",children:"Select Customer"}),e.jsxs(D,{value:n.customer_id,onValueChange:s=>{l("customer_id",s);const a=b.find(r=>r.id.toString()===s);a!=null&&a.id_number&&l("patient_id_number",a.id_number)},children:[e.jsx(w,{children:e.jsx(S,{placeholder:"Select a Customer"})}),e.jsx(k,{children:b.map(s=>e.jsxs(N,{value:s.id.toString(),children:[s.full_name," (",s.email,")"]},s.id))})]}),o.customer_id&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.customer_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"doctor_id",children:"Prescribing Doctor"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{value:n.doctor_id,onValueChange:s=>l("doctor_id",s),disabled:x.length===0,children:[e.jsx(w,{className:"flex-grow",children:e.jsx(S,{placeholder:"Choose a doctor..."})}),e.jsxs(k,{children:[x.length===0&&e.jsx(N,{value:"",disabled:!0,children:"No doctors available"}),x.map(s=>e.jsxs(N,{value:s.id.toString(),children:["Dr. ",s.name," ",s.surname," - ",s.practice_number]},s.id))]})]}),e.jsx(d,{type:"button",onClick:Z,size:"sm",variant:"outline",className:"shrink-0",children:"+ Add New Doctor"})]}),o.doctor_id&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.doctor_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"repeats_total",children:"Number of Repeats"}),e.jsx(m,{id:"repeats_total",type:"number",value:n.repeats_total===null?"":n.repeats_total,onChange:s=>l("repeats_total",s.target.value===""?null:parseInt(s.target.value,10)),min:"0"}),o.repeats_total&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.repeats_total})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold",children:"Medication Items"}),(n.items??[]).map((s,a)=>e.jsxs("div",{className:"mb-4 grid grid-cols-12 items-end gap-4 border-b pb-4 last:border-b-0",children:[e.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[e.jsx(i,{children:"Medication"}),e.jsxs(D,{value:s.medication_id?s.medication_id.toString():"",onValueChange:r=>y(a,"medication_id",parseInt(r)),children:[e.jsx(w,{children:e.jsx(S,{placeholder:"Select medication"})}),e.jsx(k,{children:p.map(r=>e.jsxs(N,{value:r.id.toString(),children:[r.name," (R",r.current_sale_price.toFixed(2),")"]},r.id))})]})]}),e.jsxs("div",{className:"col-span-12 sm:col-span-2",children:[e.jsx(i,{children:"Quantity"}),e.jsx(m,{type:"number",min:1,value:s.quantity,onChange:r=>y(a,"quantity",Math.max(1,parseInt(r.target.value)||1))})]}),e.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[e.jsx(i,{children:"Instructions"}),e.jsx(m,{value:s.instructions,onChange:r=>y(a,"instructions",r.target.value),placeholder:"e.g. Take twice daily after meals"})]}),e.jsxs("div",{className:"col-span-12 sm:col-span-1",children:[e.jsx(i,{children:"Price"}),e.jsxs("div",{className:"pt-2 font-semibold",children:["R",I(s).toFixed(2)]})]}),e.jsx("div",{className:"col-span-12 flex items-end justify-end sm:col-span-1",children:e.jsx(d,{type:"button",variant:"destructive",onClick:()=>ae(a),className:"h-8 px-2",children:"Remove"})}),ie(s)&&e.jsx("div",{className:"col-span-12 mt-1 font-semibold text-red-600",children:"⚠️ Warning: This medication contains ingredients the customer is allergic to!"})]},a)),e.jsx(d,{type:"button",onClick:te,children:"+ Add Medication Item"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"notes",children:"Pharmacist Notes"}),e.jsx(xe,{id:"notes",value:n.notes,onChange:s=>l("notes",s.target.value),placeholder:"Add any general notes or observations here...",rows:4}),o.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.notes})]}),e.jsxs("div",{className:"mt-4 text-right text-lg font-semibold",children:["Total Prescription Cost: R",re.toFixed(2)]}),e.jsxs("div",{className:"flex flex-col justify-end gap-2 pt-4 sm:flex-row",children:[e.jsx(d,{type:"submit",onClick:()=>l("status","approved"),disabled:j||t.status==="approved"||t.status==="dispensed"||t.status==="rejected",className:"w-full sm:w-auto",children:j&&n.status==="approved"?"Approving...":"Approve Prescription"}),t.is_manual&&e.jsx(d,{type:"submit",onClick:()=>l("status","dispensed"),disabled:j||t.status==="dispensed"||t.status==="pending"||t.status==="rejected",className:"w-full sm:w-auto",children:j&&n.status==="dispensed"?"Dispensing...":"Dispense Medication"}),e.jsx(d,{type:"submit",onClick:()=>l("status","rejected"),disabled:j||t.status==="rejected"||t.status==="dispensed",variant:"destructive",className:"w-full sm:w-auto",children:j&&n.status==="rejected"?"Rejecting...":"Reject Prescription"}),e.jsx(d,{asChild:!0,variant:"outline",className:"w-full sm:w-auto",children:e.jsx(oe,{href:route("pharmacist.prescriptions.index"),children:"Back to Prescriptions"})})]})]})})]})]}),F&&e.jsx(z,{open:F,onOpenChange:f,children:e.jsxs(H,{children:[e.jsx(Q,{children:e.jsx(W,{children:"Add New Doctor"})}),e.jsxs("form",{onSubmit:se,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"doctor_name_modal",children:"First Name"}),e.jsx(m,{id:"doctor_name_modal",value:_.name,onChange:s=>v("name",s.target.value),required:!0}),c.name&&e.jsx("p",{className:"text-sm text-red-500",children:c.name})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"doctor_surname_modal",children:"Surname"}),e.jsx(m,{id:"doctor_surname_modal",value:_.surname,onChange:s=>v("surname",s.target.value),required:!0}),c.surname&&e.jsx("p",{className:"text-sm text-red-500",children:c.surname})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"doctor_email_modal",children:"Email"}),e.jsx(m,{id:"doctor_email_modal",type:"email",value:_.email,onChange:s=>v("email",s.target.value),required:!0}),c.email&&e.jsx("p",{className:"text-sm text-red-500",children:c.email})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"doctor_phone_modal",children:"Phone"}),e.jsx(m,{id:"doctor_phone_modal",type:"tel",value:_.phone,onChange:s=>v("phone",s.target.value),required:!0}),c.phone&&e.jsx("p",{className:"text-sm text-red-500",children:c.phone})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"doctor_practice_number_modal",children:"Practice Number"}),e.jsx(m,{id:"doctor_practice_number_modal",value:_.practice_number,onChange:s=>v("practice_number",s.target.value),required:!0}),c.practice_number&&e.jsx("p",{className:"text-sm text-red-500",children:c.practice_number})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(ue,{asChild:!0,children:e.jsx(d,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(d,{type:"submit",disabled:X,children:"Add Doctor"})]})]})]})}),e.jsx(je,{isOpen:G,onClose:()=>P(!1),allergies:h,customerName:`${((L=t.user)==null?void 0:L.name)??"Unknown"} ${((T=t.user)==null?void 0:T.surname)??""}`})]})};export{Me as default};
